<!DOCTYPE html>
    <head>
        <title>ReflowOven</title>
    </head>
    <body style="text-align: center;"> 
    
        <table>
            <thead>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div style="text-align: center;">
                            <button onclick="send_start()">start</button>
                        </div>
                    </td>
                    <td>
                        <div style="text-align: center;">
                            <h3>BEP: Reflow Oven</h3>
                        </div>
                        
                    </td>
                    <td>
                        <div style="text-align: center;">
                            <button onclick="send_refresh()">&#8634;</button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div style="text-align: center;">
                            3
                        </div>
                    </td>
                    <td>
                        <div style="width: 80vw;">
                            <canvas id="chartcanvas"></canvas>
                        </div>
                    </td>
                    <td>
                        <div style="text-align: center;">
                            5
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div style="text-align: center;">
                            6
                        </div>
                    </td>
                    <td>
                        <div style="text-align: center;">
                            <p id="runningtext"></p>
                            <p id="heatingtext"></p>
                            <p id="heatingdutytext"></p>
                            <p id="coolingtext"></p>
                        </div>
                    </td>
                    <td>
                        <div style="text-align: center;">
                            8
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

          
          <script src="chart.js"></script>
          
          <script>
            const ctx = document.getElementById('chartcanvas');
          
            var chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['0'],
                    datasets: [{
                    label: 'Temperatuur (C)',
                    data: [0],
                    borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                    y: {
                        beginAtZero: true
                    }
                    }
                }
            });
          </script>
          


        <script type="text/javascript">

            const socket = new WebSocket("ws://"+window.location.host+":80/websocket");
            var globalstate = 0

            // Listen for messages
            socket.addEventListener("message", (event) => {
                globalstate = JSON.parse(event.data);
                // console.log(globalstate);
                
                document.getElementById("runningtext").innerHTML = 'running:' + globalstate['running'];
                document.getElementById("heatingtext").innerHTML = 'heating:' + globalstate['heating'];
                document.getElementById("heatingdutytext").innerHTML = 'heating duty cycle:' + globalstate['heating_duty'];
                document.getElementById("coolingtext").innerHTML = 'cooling:' + globalstate['cooling'];

                chart.destroy()

                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [...Array(globalstate['temp1'].length).keys()],
                        datasets: [{
                        label: 'Temperatuur1 (C)',
                        data: globalstate['temp1'],
                        borderWidth: 1
                        },
                        {
                        label: 'Temperatuur2 (C)',
                        data: globalstate['temp2'],
                        borderWidth: 1
                        }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    align: 'center',
                                    text: 'Degrees (C)',
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    align: 'center',
                                    text: 'Time (seconds back in time)',
                                }
                            }
                        },
                        animation: false,
                        transitions: false
                    }
                });

            });

            var intervalId = window.setInterval(send_refresh, 1000);

            function send_refresh(){
                socket.send(JSON.stringify({
                    'refresh': 'refresh'
                }));
            }

            function send_start(){
                socket.send(JSON.stringify({
                    'start_run': 'start_run'
                }));
            }

        </script>

    </body>
</html>